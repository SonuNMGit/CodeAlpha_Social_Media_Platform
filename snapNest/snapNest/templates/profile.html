{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.username }}'s Profile</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background-image: url('{% static "images/home.png" %}');
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Updated font */
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        
        .profile-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, rgba(173, 216, 230, 0.9), rgba(173, 216, 230, 0.7)); /* Light blue gradient */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 50px;
            position: relative; /* For positioning child elements */
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .profile-header-left {
            display: flex;
            align-items: center;
        }
        
        .profile-username {
            font-size: 36px; /* Increased font size */
            font-weight: 700; /* Bolder font */
            margin-bottom: 10px;
        }
        
        .profile-picture {
            border-radius: 50%;
            width: 120px;
            height: 120px;
            margin-right: 20px;
            object-fit: cover;
            border: 4px solid #2e8b57;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s; /* Scale effect on hover */
        }
        
        .profile-picture:hover {
            transform: scale(1.05); /* Slightly enlarge on hover */
        }
        
        .profile-info {
            display: flex;
            align-items: center;
            margin-left: 20px;
        }
        
        .profile-info div {
            margin-right: 20px;
            text-align: center;
        }
        
        .profile-info div span {
            font-weight: bold;
            font-size: 20px; /* Increased font size */
        }
        
        .edit-profile-button,
        .add-post-button,
        .follow-button {
            background: linear-gradient(45deg, #2e8b57, #4caf50); /* Gradient button */
            color: white;
            border: none;
            padding: 12px 20px; /* Adjusted padding */
            font-size: 18px; /* Increased font size */
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease, transform 0.2s; /* Added transform for scale effect */
        }
        
        .edit-profile-button:hover,
        .add-post-button:hover,
        .follow-button:hover {
            background: linear-gradient(45deg, #4caf50, #2e8b57);
            transform: scale(1.05);
        }
        
        .user-posts {
            margin-top: 30px;
        }
        
        .post-item {
            border: 1px solid #ccc;
            margin-bottom: 15px;
            padding: 15px; /* Increased padding */
            background-color: rgba(169, 169, 169, 0.5);
            border-radius: 10px; /* More rounded corners */
            transition: box-shadow 0.3s ease, transform 0.3s ease; /* Added transition */
        }
        
        .post-item:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); /* Hover shadow effect */
            transform: translateY(-3px); /* Lift effect on hover */
        }
        
        .no-posts-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .post-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            margin-top: 10px;
            border-radius: 8px;
        }
        
        .followers-list,
        .following-list {
            display: none;
            padding-top: 20px;
        }
        
        .followers-list h3,
        .following-list h3 {
            font-size: 24px; /* Increased font size for section titles */
            margin-bottom: 10px;
            text-align: left;
            font-weight: 600;
        }
        
        .like-button {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 24px;
            transition: color 0.3s ease;
        }
        
        .like-button.liked {
            color: #ff0000;
        }
        
        .comment-box {
            width: 90%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .comment-item {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #eee;
            background-color: #f9f9f9;
            border-radius: 5px;
            transition: background-color 0.3s ease; /* Transition for hover */
        }
        
        .comment-item:hover {
            background-color: #f1f1f1; /* Light hover effect */
        }
        
        .comment-owner {
            font-weight: bold;
        }
        
        .delete-comment-button {
            background: none;
            border: none;
            color: red;
            cursor: pointer;
        }
        
        .delete-comment-button:hover {
            color: darkred;
        }        
        
    </style>
</head>
<body>
    {% include 'header.html' %}
    <div class="profile-container">
       
        <div class="profile-header">
            <div class="profile-header-left">
                
                {% if user.userprofile.profile_photo %}
                    <img src="{{ user.userprofile.profile_photo.url }}" alt="{{ user.username }}" class="profile-picture">
                {% else %}
                    <img src="{% static 'images/home.jpg' %}" alt="Default Profile Picture" class="profile-picture">
                {% endif %}
                
                <div>
                    <h1 class="profile-username">{{ user.username }}</h1>
                    <div class="profile-info">
                        <div>
                            <span>{{ user.posts.count }}</span><br>Posts
                        </div>
                        <div>
                            <span><a href="#" id="followers-link">{{ user.userprofile.followers.count }}</a></span><br>Followers
                        </div>
                        <div>
                            <span><a href="#" id="following-link">{{ user.userprofile.following.count }}</a></span><br>Following
                        </div>
                    </div>
                </div>
            </div>
           
            {% if user == request.user %}
                
                <div>
                    <a href="{% url 'update_profile' %}">
                        <button class="edit-profile-button">Edit Profile</button>
                    </a>
                    <a href="{% url 'add_post' %}">
                        <button class="add-post-button">Add Post</button>
                    </a>
                    <a href="{% url 'messages' %}">
                        <button class="add-post-button">Message</button>
                    </a>
                </div>
            {% else %}
                {% if user != request.user %}
                    
                    {% if user not in request.user.userprofile.following.all %}
                        <form id="follow-form" action="{% url 'follow_user' user.id %}" method="POST" data-user-id="{{ user.id }}">
                            {% csrf_token %}
                            <button type="submit" class="follow-button">Follow</button>
                        </form>
                    {% else %}
                        <form id="unfollow-form" action="{% url 'unfollow_user' user.id %}" method="POST" data-user-id="{{ user.id }}">
                            {% csrf_token %}
                            <button type="submit" class="follow-button">Unfollow</button>
                        </form>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>

        
        <div id="followers-section" class="followers-list">
            <h3>Followers</h3>
            {% if user.userprofile.followers.all %}
                <ul>
                    {% for follower in user.userprofile.followers.all %}
                        <li>{{ follower.username }}
                            {% if user == request.user %}
                                
                                <form action="{% url 'remove_follower' follower.id %}" method="POST" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="remove-follower-button">Remove Follower</button>
                                </form>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No one is following you yet.</p>
            {% endif %}
        </div>

        
        <div id="following-section" class="following-list">
            <h3>Following</h3>
            {% if user.userprofile.following.all %}
                    <ul>
                        {% for following_user in user.userprofile.following.all %}
                            <li>{{ following_user.username }}
                                {% if user == request.user %}
                                    <form action="{% url 'unfollow_user' following_user.id %}" method="POST" style="display:inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="remove-following-button">Unfollow</button>
                                    </form>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
            {% else %}
                <p>You are not following anyone yet.</p>
            {% endif %}
        </div>
            
            {% if user.userprofile.privacy == 'private' and request.user not in user.userprofile.followers.all and user != request.user %}
                <p>This account is private. Follow to see the posts.</p>
            {% else %}
                
                <div class="user-posts">
                    <h2>{{ user.username }}'s Posts</h2>
                    <div>
                        {% for post in user.posts.all %}
                            <div class="post-item">
                                <h3>{{ post.title }}</h3>
                                <p>{{ post.content }}</p>

                                
                                {% if post.image %}
                                    <img src="{{ post.image.url }}" alt="Post Image" class="post-image">
                                {% endif %}

                                
                                <form action="{% url 'like_post' post.id %}" method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="like-button {% if request.user in post.likes.all %}liked{% endif %}">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </form>
                                <span>{{ post.likes.count }} Likes</span>

                                
                                <div class="comment-section">
                                    
                                    <form action="{% url 'add_comment' post.id %}" method="POST">
                                        {% csrf_token %}
                                        <textarea name="comment" class="comment-box" placeholder="Write a comment..." required></textarea>
                                        <button type="submit">Comment</button>
                                    </form>

                                    
                                    <div class="comments-list">
                                        {% for comment in post.comments.all %}
                                            <div class="comment-item">
                                                <span class="comment-owner">{{ comment.user.username }}</span>: {{ comment.content }}
                                                
                                                {% if comment.user == request.user %}
                                                    <form action="{% url 'delete_comment' comment.id %}" method="POST" style="display:inline;">
                                                        {% csrf_token %}
                                                        <button type="submit" class="delete-comment-button">Delete</button>
                                                    </form>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>

                                {% if user == request.user %}
                                    <form action="{% url 'delete_post' post.id %}" method="POST">
                                        {% csrf_token %}
                                        <button type="submit" class="delete-button">Delete Post</button>
                                    </form>
                                {% endif %}
                            </div>
                        {% empty %}
                            <div class="no-posts-container">
                                <p>{{ user.username }} hasn't posted anything yet.</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
    </div>   
    {% include 'footer.html' %}

    <script>
        
        document.getElementById('followers-link').addEventListener('click', function (e) {
            e.preventDefault();
            var followersSection = document.getElementById('followers-section');
            var followingSection = document.getElementById('following-section');
            
            followersSection.style.display = followersSection.style.display === 'block' ? 'none' : 'block';
            followingSection.style.display = 'none'; 
        });

        document.getElementById('following-link').addEventListener('click', function (e) {
            e.preventDefault();
            var followingSection = document.getElementById('following-section');
            var followersSection = document.getElementById('followers-section');

            followingSection.style.display = followingSection.style.display === 'block' ? 'none' : 'block';
            followersSection.style.display = 'none';  
        });
    </script>
</body>
</html>
